<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=UTF-8" />
<title>File: UsingWithRails</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header" class="clearfix">
      
      <div id="logo">DRAGONFLY (v 0.6.0)</div>
      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

    </div>
    
    <div>
      <iframe id="search_frame"></iframe>
    </div>
    
    <div id="content" class="clearfix">
      <div class="col1">
        <div id='filecontents'><h1>Using With Rails</h1>

<p>Dragonfly works with both Rails 2.3 and Rails 3.</p>

<p>The main way to use Dragonfly with Rails is as a <tt><a href="Dragonfly/Middleware.html" title="Dragonfly::Middleware (class)">middleware</a></tt>.</p>

<h2>1. Setting up</h2>

<h2>The quick way</h2>

<p>There is a ready-made file which sets up Dragonfly for image processing for your rails app.
If image resizing, etc. is all you want to do, then put this in an initializer, e.g config/initializers/dragonfly.rb:</p>

<pre class="code"><span class='require identifier id'>require</span> <span class='string val'>'dragonfly/rails/images'</span>
</pre>

<p>This file initializes a dragonfly app, configures it to use rmagick processing, encoding, etc.,
registers the app so that you can use ActiveRecord accessors, and inserts it into the Rails middleware stack.</p>

<h2>The more explicit way</h2>

<p>You can do the above explicitly.</p>

<p>config/initializers/dragonfly.rb:</p>

<pre class="code"><span class='require identifier id'>require</span> <span class='string val'>'dragonfly'</span>

<span class='app identifier id'>app</span> <span class='assign token'>=</span> <span class='Dragonfly constant id'>Dragonfly</span><span class='colon2 op'>::</span><span class='App constant id'>App</span><span class='lbrack token'>[</span><span class='symbol val'>:images</span><span class='rbrack token'>]</span>
<span class='app identifier id'>app</span><span class='dot token'>.</span><span class='configure_with identifier id'>configure_with</span><span class='lparen token'>(</span><span class='Dragonfly constant id'>Dragonfly</span><span class='colon2 op'>::</span><span class='Config constant id'>Config</span><span class='colon2 op'>::</span><span class='RailsImages constant id'>RailsImages</span><span class='rparen token'>)</span>

<span class='comment val'># Define the method 'image_accessor' in ActiveRecord models</span>
<span class='Dragonfly constant id'>Dragonfly</span><span class='dot token'>.</span><span class='active_record_macro identifier id'>active_record_macro</span><span class='lparen token'>(</span><span class='symbol val'>:image</span><span class='comma token'>,</span> <span class='app identifier id'>app</span><span class='rparen token'>)</span>
</pre>

<p>environment.rb (application.rb in Rails 3):</p>

<pre class="code"><span class='config identifier id'>config</span><span class='dot token'>.</span><span class='middleware identifier id'>middleware</span><span class='dot token'>.</span><span class='insert_after identifier id'>insert_after</span> <span class='string val'>'Rack::Lock'</span><span class='comma token'>,</span> <span class='string val'>'Dragonfly::Middleware'</span><span class='comma token'>,</span> <span class='symbol val'>:images</span>
<span class='config identifier id'>config</span><span class='dot token'>.</span><span class='middleware identifier id'>middleware</span><span class='dot token'>.</span><span class='insert_before identifier id'>insert_before</span> <span class='string val'>'Dragonfly::Middleware'</span><span class='comma token'>,</span> <span class='string val'>'Rack::Cache'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span>
  <span class='symbol val'>:verbose</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
  <span class='symbol val'>:metastore</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;file:#{Rails.root}/tmp/dragonfly/cache/meta&quot;</span><span class='comma token'>,</span>
  <span class='symbol val'>:entitystore</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;file:#{Rails.root}/tmp/dragonfly/cache/body&quot;</span>
<span class='rbrace token'>}</span>
</pre>

<h2>2. Gem dependencies</h2>

<p>Tell Rails about the gem dependencies in the usual way:</p>

<p>For Rails 2.3 add this to config/environment.rb:</p>

<pre class="code"><span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>'rmagick'</span><span class='comma token'>,</span>    <span class='symbol val'>:lib</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'RMagick'</span>      <span class='comment val'># only if used</span>
<span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>'rack-cache'</span><span class='comma token'>,</span> <span class='symbol val'>:lib</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'rack/cache'</span>   <span class='comment val'># only if used</span>
<span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>'dragonfly'</span>
</pre>

<p>For Rails 3 add it to the Gemfile, e.g.:</p>

<pre class="code"><span class='gem identifier id'>gem</span> <span class='string val'>'rmagick'</span><span class='comma token'>,</span>    <span class='symbol val'>:require</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'RMagick'</span>         <span class='comment val'># only if used</span>
<span class='gem identifier id'>gem</span> <span class='string val'>'rack-cache'</span><span class='comma token'>,</span> <span class='symbol val'>:require</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'rack/cache'</span>      <span class='comment val'># only if used</span>
<span class='gem identifier id'>gem</span> <span class='string val'>'dragonfly'</span>
</pre>

<p>You only need the lines above for <a href="http://tomayko.com/src/rack-cache/" target="_parent" title="rack-cache">rack-cache</a> and
<a href="http://rmagick.rubyforge.org/" target="_parent" title="rmagick">rmagick</a> if you've used the file 'dragonfly/rails/images', or manually used them yourself.</p>

<h2>3. Use it!</h2>

<p>Now that you have a parasitic Dragonfly app living inside your Rails app, you can upload media to your models, display/play around with them, etc.</p>

<p>To see what you can do with the active record accessors, see <a href="file.ActiveRecord.html" title="ActiveRecord">ActiveRecord</a>.</p>

<p>For more info about general Dragonfly setup, including avoiding denial-of-service attacks, see <a href="file.GettingStarted.html" title="GettingStarted">GettingStarted</a>.</p>

<h2>Extra Config</h2>

<p>There are one or two config options you may commonly want to tweak.
In this case, add something like the following to your initializer:</p>

<pre class="code"><span class='Dragonfly constant id'>Dragonfly</span><span class='colon2 op'>::</span><span class='App constant id'>App</span><span class='lbrack token'>[</span><span class='symbol val'>:images</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='configure identifier id'>configure</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span>
  <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='url_handler identifier id'>url_handler</span><span class='dot token'>.</span><span class='path_prefix identifier id'>path_prefix</span> <span class='assign token'>=</span> <span class='string val'>'/attachments'</span>   <span class='comment val'># configures where the Dragonfly app is served from - default '/media'</span>
  <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='url_handler identifier id'>url_handler</span><span class='dot token'>.</span><span class='secret identifier id'>secret</span> <span class='assign token'>=</span> <span class='string val'>'PUT A SECRET HERE!!'</span> <span class='comment val'># for protecting from Denial-Of-Service attacks</span>
<span class='end end kw'>end</span>
</pre>
</div>
      </div>
      <div class="col2">
        <ul class="main_files clearfix">
          <li><a href="file.README.html" title="Quick start for Rails (README)">Quick start for Rails (README)</a></li><li><a href="file.GettingStarted.html" title="Getting started">Getting started</a></li><li><a href="file.UsingWithRails.html" title="Using with Rails">Using with Rails</a></li><li><a href="file.ActiveRecord.html" title="Using with ActiveRecord">Using with ActiveRecord</a></li><li><a href="file.DataStorage.html" title="Data Storage">Data Storage</a></li><li><a href="file.Analysers.html" title="Analysers">Analysers</a></li><li><a href="file.Processing.html" title="Processing">Processing</a></li><li><a href="file.Encoding.html" title="Encoding">Encoding</a></li><li><a href="file.Shortcuts.html" title="Shortcuts for processing and encoding">Shortcuts for processing and encoding</a></li><li><a href="file.MimeTypes.html" title="Mime Types">Mime Types</a></li><li><a href="file.ExampleUseCases.html" title="Example use cases">Example use cases</a></li><li><a href="file.History.html" title="History">History</a></li>
        </ul>
      </div>
    </div>
    
    <div id="footer">
  Generated on Tue May 11 15:08:22 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.5.3 (ruby-1.8.7).
</div>

  </body>
</html>