<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta name="Content-Type" content="text/html; charset=utf-8" />
<title>File: Processing</title>
<link rel="stylesheet" href="css/style.css" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '';
  if (relpath != '') relpath += '/';
</script>
<script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="js/app.js"></script>

  </head>
  <body>
    
    <!-- GOOGLE ANALYTICS -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-16382932-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    <!-- *************** -->
    
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header" class="clearfix">
      
      <div id="logo">DRAGONFLY (v 0.6.2)</div>
      <div id="search">
  <a id="class_list_link" href="#">Class List</a>
  <a id="method_list_link" href="#">Method List</a>
  <a id ="file_list_link" href="#">File List</a>
</div>

    </div>
    
    <div>
      <iframe id="search_frame"></iframe>
    </div>
    
    <div id="content" class="clearfix">
      <div class="col1">
        <div id='filecontents'><h1>Processing</h1>

<p>Processing is changing content in some way, and does not involve encoding.
For example, resizing an image is classed as processing, whereas converting it from 'png' to 'jpeg' is classed as encoding.</p>

<p>All processing jobs are defined by a processing method and a processing options hash (which is passed to the method).</p>

<p>Let's say we have a dragonfly app called 'images'</p>

<pre class="code"><span class='id app'>app</span> <span class='op'>=</span> <span class='const'>Dragonfly</span><span class='op'>::</span><span class='const'>App</span><span class='lbracket'>[</span><span class='symbol'>:images</span><span class='rbracket'>]</span>
</pre>

<p>Data gets passed around between the datastore, processor, analyser, etc. in the form of an <tt><a href="Dragonfly/ExtendedTempObject.html" title="Dragonfly::ExtendedTempObject (class)">ExtendedTempObject</a></tt>.</p>

<pre class="code"><span class='id temp_object'>temp_object</span> <span class='op'>=</span> <span class='id app'>app</span><span class='period'>.</span><span class='id create_object'>create_object</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>path/to/image.png</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
</pre>

<p>We can process this object with any of the methods which have been registered with the app's processor.
For example, registering the <tt><a href="Dragonfly/Processing/RMagickProcessor.html" title="Dragonfly::Processing::RMagickProcessor (class)">rmagick processor</a></tt></p>

<pre class="code"><span class='id app'>app</span><span class='period'>.</span><span class='id register_processor'>register_processor</span><span class='lparen'>(</span><span class='const'>Dragonfly</span><span class='op'>::</span><span class='const'>Processing</span><span class='op'>::</span><span class='const'>RMagickProcessor</span><span class='rparen'>)</span>
</pre>

<p>give us the processing methods <code>resize</code>, <code>crop</code>, <code>resize_and_crop</code>, <code>rotate</code>, etc.</p>

<pre class="code"><span class='id temp_object'>temp_object</span><span class='period'>.</span><span class='id process'>process</span><span class='lparen'>(</span><span class='symbol'>:resize</span><span class='comma'>,</span> <span class='symbol'>:geometry</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>30x30!</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>        <span class='comment'># =&gt; returns a new temp_object with width x height = 30x30
</span><span class='id temp_object'>temp_object</span><span class='period'>.</span><span class='id process!'>process!</span><span class='lparen'>(</span><span class='symbol'>:resize</span><span class='comma'>,</span> <span class='symbol'>:geometry</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>30x30!</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>       <span class='comment'># =&gt; resizes its own data
</span></pre>

<p>The saved configuration <tt><a href="Dragonfly/Config/RMagickImages.html" title="Dragonfly::Config::RMagickImages (module)">RMagickImages</a></tt> registers the above processor automatically.</p>

<h2>Custom Processing</h2>

<p>To register a custom processor, derive from <tt><a href="Dragonfly/Processing/Base.html" title="Dragonfly::Processing::Base (class)">Processing::Base</a></tt> and register.
Each method takes the temp_object, and the (optional) processing options hash as its argument.</p>

<pre class="code"><span class='kw'>class</span> <span class='const'>MyProcessor</span> <span class='op'>&lt;</span> <span class='const'>Dragonfly</span><span class='op'>::</span><span class='const'>Processing</span><span class='op'>::</span><span class='const'>Base</span>

  <span class='kw'>def</span> <span class='id black_and_white'>black_and_white</span><span class='lparen'>(</span><span class='id temp_object'>temp_object</span><span class='comma'>,</span> <span class='id opts'>opts</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='comment'># use temp_object.data, temp_object.path, etc...
</span>    <span class='comment'># ...process and return a String, File, Tempfile or TempObject
</span>  <span class='kw'>end</span>

  <span class='comment'># ... add as many methods as you wish
</span>
<span class='kw'>end</span>

<span class='id app'>app</span> <span class='op'>=</span> <span class='const'>Dragonfly</span><span class='op'>::</span><span class='const'>App</span><span class='lbracket'>[</span><span class='symbol'>:images</span><span class='rbracket'>]</span>
<span class='id app'>app</span><span class='period'>.</span><span class='id register_processor'>register_processor</span><span class='lparen'>(</span><span class='const'>MyProcessor</span><span class='rparen'>)</span>
</pre>

<p>You can register multiple processors.</p>

<p>As with analysers and encoders, if the processor is <tt><a href="Dragonfly/Configurable.html" title="Dragonfly::Configurable (module)">configurable</a></tt>, we can configure it as we register it if we need to</p>

<pre class="code"><span class='id app'>app</span><span class='period'>.</span><span class='id register_processor'>register_processor</span><span class='lparen'>(</span><span class='const'>MyProcessor</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id p'>p</span><span class='op'>|</span>
  <span class='id p'>p</span><span class='period'>.</span><span class='id some_attribute'>some_attribute</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>hello</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</pre>

<p>Your new processing method is now available to use:</p>

<pre class="code"><span class='id temp_object'>temp_object</span> <span class='op'>=</span> <span class='id app'>app</span><span class='period'>.</span><span class='id create_object'>create_object</span><span class='lparen'>(</span><span class='const'>File</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>path/to/image.png</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='id temp_object'>temp_object</span><span class='period'>.</span><span class='id process'>process</span><span class='lparen'>(</span><span class='symbol'>:black_and_white</span><span class='comma'>,</span> <span class='symbol'>:some</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>option</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>         <span class='comment'># processed temp_object
</span></pre>

<p>To get the url for content processed by your custom processor, the long way is using something like:</p>

<pre class="code"><span class='id app'>app</span><span class='period'>.</span><span class='id url_for'>url_for</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>some_uid</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:processing_method</span> <span class='op'>=&gt;</span> <span class='symbol'>:black_and_white</span><span class='comma'>,</span>
  <span class='symbol'>:processing_options</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:size</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>30x30</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:png</span>
<span class='rparen'>)</span>
</pre>

<p>or if using an activerecord model,</p>

<pre class="code"><span class='id my_model'>my_model</span><span class='period'>.</span><span class='id preview_image'>preview_image</span><span class='period'>.</span><span class='id url'>url</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>some_uid</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
  <span class='symbol'>:processing_method</span> <span class='op'>=&gt;</span> <span class='symbol'>:black_and_white</span><span class='comma'>,</span>
  <span class='symbol'>:processing_options</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:size</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>30x30</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:png</span>
<span class='rparen'>)</span>
</pre>

<p>However, this could soon get tedious if using more than once, so the best thing is to register a shortcut for it.
So in your configuration of the Dragonfly app (or in an initializer if using 'dragonfly/rails/images') you
could do something like:</p>

<pre class="code"><span class='id app'>app</span><span class='period'>.</span><span class='id parameters'>parameters</span><span class='period'>.</span><span class='id add_shortcut'>add_shortcut</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^bw-(\d*x\d*)$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id string'>string</span><span class='comma'>,</span> <span class='id match_data'>match_data</span><span class='op'>|</span>
  <span class='lbrace'>{</span>
    <span class='symbol'>:processing_method</span> <span class='op'>=&gt;</span> <span class='symbol'>:black_and_white</span><span class='comma'>,</span>
    <span class='symbol'>:processing_options</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:size</span> <span class='op'>=&gt;</span> <span class='id match_data'>match_data</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:png</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span>
</pre>

<p>Now you can get urls by using the shortcut:</p>

<pre class="code"><span class='id app'>app</span><span class='period'>.</span><span class='id url_for'>url_for</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>some_uid</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>bw-30x30</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
</pre>

<p>or with activerecord:</p>

<pre class="code"><span class='id my_model'>my_model</span><span class='period'>.</span><span class='id preview_image'>preview_image</span><span class='period'>.</span><span class='id url'>url</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>bw-30x30</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
</pre>

<p>For more information about shortcuts, see <a href="file.Shortcuts.html" title="Shortcuts">Shortcuts</a>.</p></div>
      </div>
      <div class="col2">
        <ul class="main_files clearfix">
          <li><a href="file.README.html" title="Quick start for Rails (README)">Quick start for Rails (README)</a></li><li><a href="file.GettingStarted.html" title="Getting started">Getting started</a></li><li><a href="file.UsingWithRails.html" title="Using with Rails">Using with Rails</a></li><li><a href="file.ActiveRecord.html" title="Using with ActiveRecord">Using with ActiveRecord</a></li><li><a href="file.DataStorage.html" title="Data Storage">Data Storage</a></li><li><a href="file.Analysers.html" title="Analysers">Analysers</a></li><li><a href="file.Processing.html" title="Processing">Processing</a></li><li><a href="file.Encoding.html" title="Encoding">Encoding</a></li><li><a href="file.Shortcuts.html" title="Shortcuts for processing and encoding">Shortcuts for processing and encoding</a></li><li><a href="file.MimeTypes.html" title="Mime Types">Mime Types</a></li><li><a href="file.ExampleUseCases.html" title="Example use cases">Example use cases</a></li><li><a href="file.History.html" title="History">History</a></li>
        </ul>
      </div>
    </div>
    
    <div id="footer">
  Generated on Wed Aug 25 00:53:43 2010 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool">yard</a>
  0.5.8 (ruby-1.9.2).
</div>

  </body>
</html>